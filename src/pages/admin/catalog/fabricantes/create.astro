---
import AdminLayout from '@/layouts/AdminLayout.astro';
import { getAdminAuth, requireAdmin } from '@/lib/auth';
import { createSupabaseClient } from '@/lib/supabase';

const auth = await getAdminAuth(Astro);
const user = requireAdmin(auth);

if (!user) {
  return Astro.redirect('/auth/login?redirect=/admin/catalog/fabricantes/create');
}

const supabase = createSupabaseClient(Astro);

// Get providers that offer fabrication services (have "fabricantes" category)
const { data: providers } = await supabase
  .from('providers')
  .select(`
    id,
    company_name,
    tier,
    provider_categories!inner(category_type)
  `)
  .eq('status', 'active')
  .eq('provider_categories.category_type', 'fabricantes')
  .order('company_name');

// Get Chilean regions for dropdown
const chileanRegions = [
  'Arica y Parinacota', 'Tarapacá', 'Antofagasta', 'Atacama', 'Coquimbo',
  'Valparaíso', 'Región Metropolitana', "O'Higgins", 'Maule', 'Ñuble',
  'Biobío', 'La Araucanía', 'Los Ríos', 'Los Lagos', 'Aysén',
  'Magallanes y Antártica Chilena'
];

// Get fabricante features from database (same as houses)
// First get the fabricantes category ID
const { data: fabricantesCategory } = await supabase
  .from('categories')
  .select('id')
  .eq('slug', 'fabricantes')
  .single();

const { data: fabricanteFeatures } = await supabase
  .from('features')
  .select('*')
  .eq('category_id', fabricantesCategory?.id!)
  .eq('is_active', true)
  .order('name');
---

<AdminLayout title="Nuevo Fabricante", user={user}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">Nuevo Fabricante</h1>
          <p class="mt-1 text-sm text-gray-500">
            Agregue un nuevo fabricante al catálogo
          </p>
        </div>
        <a
          href="/admin/catalog/fabricantes"
          class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
        >
          <svg class="mr-2 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Volver al listado
        </a>
      </div>
    </div>

    <form id="fabricanteForm" class="space-y-8">
      <!-- Basic Information -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-medium text-gray-900">Información Básica</h2>
        </div>
        <div class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Proveedor <span class="text-red-500">*</span>
              </label>
              <select
                name="provider_id"
                required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              >
                <option value="">Seleccione un proveedor</option>
                {providers?.map((provider) => (
                  <option value={provider.id}>{provider.company_name}</option>
                ))}
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">
                Nombre del Servicio <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                name="name"
                required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="Ej: Fabricación de Casas Modulares"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                SKU
              </label>
              <input
                type="text"
                name="sku"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="FAB-001"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">
                Slug URL
              </label>
              <input
                type="text"
                name="slug"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="fabricacion-casas-modulares (se genera automáticamente)"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                RUT Empresa
              </label>
              <input
                type="text"
                name="tax_id"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="12.345.678-9"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Años de Experiencia
              </label>
              <input
                type="number"
                name="years_experience"
                min="0"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="10"
              />
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">
              Descripción de la Empresa
            </label>
            <textarea
              name="description"
              rows="3"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              placeholder="Descripción de la empresa, su experiencia y especialidades"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- Contact Information -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-medium text-gray-900">Información de Contacto</h2>
        </div>
        <div class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Email Principal <span class="text-red-500">*</span>
              </label>
              <input
                type="email"
                name="email"
                required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="contacto@empresa.com"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Teléfono Principal
              </label>
              <input
                type="tel"
                name="phone"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="+56 9 1234 5678"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                WhatsApp
              </label>
              <input
                type="tel"
                name="whatsapp"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="+56 9 1234 5678"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Sitio Web
              </label>
              <input
                type="url"
                name="website"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="https://www.empresa.com"
              />
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Persona de Contacto
              </label>
              <input
                type="text"
                name="contact_person"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="Nombre del contacto principal"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Cargo del Contacto
              </label>
              <input
                type="text"
                name="contact_position"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="Gerente Comercial"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Location -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-medium text-gray-900">Ubicación</h2>
        </div>
        <div class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Región Principal
              </label>
              <select
                name="region"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              >
                <option value="">Seleccionar región</option>
                {chileanRegions.map(region => (
                  <option value={region}>{region}</option>
                ))}
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Ciudad
              </label>
              <input
                type="text"
                name="city"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="Ciudad donde opera"
              />
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">
              Dirección Completa
            </label>
            <textarea
              name="address"
              rows="2"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              placeholder="Dirección completa de las oficinas principales"
            ></textarea>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">
              Zonas de Cobertura
            </label>
            <textarea
              name="coverage_areas"
              rows="2"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              placeholder="Regiones o comunas donde prestan servicios (separadas por comas)"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- Business Information -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-medium text-gray-900">Información Comercial</h2>
        </div>
        <div class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Precio Desde (CLP)
              </label>
              <input
                type="number"
                name="price_range_min"
                min="0"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="15000000"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Precio Hasta (CLP)
              </label>
              <input
                type="number"
                name="price_range_max"
                min="0"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="50000000"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Moneda
              </label>
              <select
                name="currency"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              >
                <option value="CLP">CLP - Peso Chileno</option>
                <option value="USD">USD - Dólar</option>
                <option value="UF">UF - Unidad de Fomento</option>
              </select>
            </div>
          </div>
          
          <!-- Grouped Fabricante Features from Business Model -->

          <!-- Servicios Disponibles -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-900 mb-3">Servicios Disponibles</label>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
              {fabricanteFeatures?.filter(f =>
                ['diseno-standard', 'diseno-personalizado', 'instalacion-premontada',
                 'construccion-terreno', 'instalacion', 'kits-autoconstruccion',
                 'asesoria-tecnica', 'asesoria-legal', 'construccion-personalizada',
                 'logistica-transporte', 'financiamiento'].includes(f.slug)
              ).map(feature => (
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    name={`feature_${feature.slug}`}
                    id={`feature_${feature.slug}`}
                    value={feature.name}
                    class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                  />
                  <label for={`feature_${feature.slug}`} class="ml-2 block text-sm text-gray-900">
                    {feature.name}
                  </label>
                </div>
              ))}
            </div>
          </div>

          <!-- Especialidades -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-900 mb-3">Especialidades</label>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
              {fabricanteFeatures?.filter(f =>
                ['tiny-houses', 'casas-panel-sip', 'casas-container', 'casas-hormigon',
                 'casas-madera', 'prefab-madera', 'oficinas-container'].includes(f.slug)
              ).map(feature => (
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    name={`feature_${feature.slug}`}
                    id={`feature_${feature.slug}`}
                    value={feature.name}
                    class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                  />
                  <label for={`feature_${feature.slug}`} class="ml-2 block text-sm text-gray-900">
                    {feature.name}
                  </label>
                </div>
              ))}
            </div>
          </div>

          <!-- Llave en Mano (Special Category) -->
          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-900 mb-3">Modalidad</label>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
              {fabricanteFeatures?.filter(f => f.slug === 'llave-en-mano').map(feature => (
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    name={`feature_${feature.slug}`}
                    id={`feature_${feature.slug}`}
                    value={feature.name}
                    class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                  />
                  <label for={`feature_${feature.slug}`} class="ml-2 block text-sm text-gray-900">
                    {feature.name}
                  </label>
                </div>
              ))}
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">
              Certificaciones
            </label>
            <textarea
              name="certifications"
              rows="2"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              placeholder="Certificaciones, licencias o acreditaciones (separadas por comas)"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- Images & Media -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-medium text-gray-900">Imágenes y Media</h2>
        </div>
        <div class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">
                URL del Logo
              </label>
              <input
                type="url"
                name="logo_url"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="https://ejemplo.com/logo.png"
              />
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                URL Imagen de Portada
              </label>
              <input
                type="url"
                name="cover_image_url"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="https://ejemplo.com/portada.jpg"
              />
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Galería de Imágenes
            </label>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
              <p class="text-sm text-gray-500">Galería de imágenes (funcionalidad próximamente)</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Internal Management -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-medium text-gray-900">Gestión Interna</h2>
        </div>
        <div class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Calificación Interna
              </label>
              <select
                name="internal_rating"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              >
                <option value="">Sin calificar</option>
                <option value="1">★☆☆☆☆ (1)</option>
                <option value="2">★★☆☆☆ (2)</option>
                <option value="3">★★★☆☆ (3)</option>
                <option value="4">★★★★☆ (4)</option>
                <option value="5">★★★★★ (5)</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Verificación KYC
              </label>
              <select
                name="kyc_status"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              >
                <option value="pending">Pendiente</option>
                <option value="verified">Verificado</option>
                <option value="rejected">Rechazado</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Comisión (%)
              </label>
              <input
                type="number"
                name="commission_rate"
                min="0"
                max="100"
                step="0.1"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
                placeholder="5.0"
              />
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">
              Notas Internas
            </label>
            <textarea
              name="admin_notes"
              rows="3"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              placeholder="Notas internas sobre el fabricante (no visible al público)"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- SEO & Status -->
      <div class="bg-white shadow rounded-lg">
        <div class="px-6 py-4 border-b border-gray-200">
          <h2 class="text-lg font-medium text-gray-900">SEO y Estado</h2>
        </div>
        <div class="px-6 py-4 space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Estado <span class="text-red-500">*</span>
              </label>
              <select
                name="status"
                required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              >
                <option value="draft">Borrador</option>
                <option value="pending_review">Pendiente Revisión</option>
                <option value="active">Activo</option>
                <option value="inactive">Inactivo</option>
                <option value="rejected">Rechazado</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700">
                Tier
              </label>
              <select
                name="tier"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              >
                <option value="standard">Standard</option>
                <option value="destacado">Destacado</option>
                <option value="premium">Premium</option>
              </select>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">
              Meta Title
            </label>
            <input
              type="text"
              name="meta_title"
              maxlength="60"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
            />
            <p class="mt-1 text-sm text-gray-500">Máximo 60 caracteres</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">
              Meta Description
            </label>
            <textarea
              name="meta_description"
              rows="2"
              maxlength="160"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
            ></textarea>
            <p class="mt-1 text-sm text-gray-500">Máximo 160 caracteres</p>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700">
              Keywords
            </label>
            <input
              type="text"
              name="keywords"
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"
              placeholder="fabricante casas, modular, prefabricada (separadas por comas)"
            />
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="flex justify-end space-x-3">
        <button
          type="button"
          onclick="saveDraft()"
          class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
        >
          Guardar Borrador
        </button>
        <button
          type="submit"
          class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"
        >
          Crear Fabricante
        </button>
      </div>
    </form>
  </div>


  <script is:inline>
    // Auto-generate slug from service name
    document.querySelector('input[name="name"]')?.addEventListener('input', (e) => {
      const slugInput = document.querySelector('input[name="slug"]');
      if (slugInput && !slugInput.value) {
        const slug = e.target.value
          .toLowerCase()
          .replace(/[áàäâã]/g, 'a')
          .replace(/[éèëê]/g, 'e')
          .replace(/[íìïî]/g, 'i')
          .replace(/[óòöôõ]/g, 'o')
          .replace(/[úùüû]/g, 'u')
          .replace(/[ñ]/g, 'n')
          .replace(/[^a-z0-9]+/g, '-')
          .replace(/^-+|-+$/g, '');
        slugInput.value = slug;
      }
    });

    // Form submission
    document.getElementById('fabricanteForm')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);
      
      // Collect selected features
      const selectedFeatures = [];
      formData.forEach((value, key) => {
        if (key.startsWith('feature_')) {
          selectedFeatures.push(value);
        }
      });
      data.features = selectedFeatures;

      // Clean up feature fields from data
      Object.keys(data).forEach(key => {
        if (key.startsWith('feature_')) {
          delete data[key];
        }
      });

      // Parse arrays from comma-separated strings
      if (data.regions) {
        data.regions = data.regions.split(',').map(region => region.trim());
      }
      if (data.certifications) {
        data.certifications = data.certifications.split(',').map(cert => cert.trim());
      }
      if (data.keywords) {
        data.keywords = data.keywords.split(',').map(keyword => keyword.trim());
      }

      // Parse numeric fields
      ['price_range_min', 'price_range_max', 'price_per_unit', 'lead_time_days', 'warranty_years', 'internal_rating'].forEach(field => {
        if (data[field] && data[field] !== '') {
          data[field] = parseFloat(data[field]);
        }
      });

      // Parse boolean fields
      data.coverage_national = data.coverage_national === 'on';
      data.custom_design = data.custom_design === 'on';
      data.cad_service = data.cad_service === 'on';
      data.installation_service = data.installation_service === 'on';
      data.featured = data.featured === 'on';

      // Set default values
      data.gallery_images = [];
      data.status = data.status || 'draft';
      data.tier = data.tier || 'standard';
      
      try {
        const response = await fetch('/api/admin/fabricantes', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        
        if (response.ok) {
          const result = await response.json();
          window.location.href = `/admin/catalog/fabricantes/${result.fabricante.id}/edit`;
        } else {
          const error = await response.json();
          alert(`Error al crear el fabricante: ${error.error}`);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error al crear el fabricante');
      }
    });

    function saveDraft() {
      const form = document.getElementById('fabricanteForm');
      const statusSelect = form.querySelector('select[name="status"]');
      statusSelect.value = 'draft';
      form.dispatchEvent(new Event('submit'));
    }
  </script>
</AdminLayout>